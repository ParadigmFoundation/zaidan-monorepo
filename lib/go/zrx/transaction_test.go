package zrx

import (
	"encoding/json"
	"testing"

	"github.com/stretchr/testify/assert"

	"github.com/stretchr/testify/require"
)

const ZeroExTestChainID = 1337

// generated from 0x libraries
const KnownTransactionJSON = `{"signerAddress":"0x6ecbe1db9ef729cbe972c83fb886247691fb6beb","salt":"12470326983290661436583757585654870627576033914457903912207696420256245193881","data":"0x9b44d55600000000000000000000000000000000000000000000000000000000000000600000000000000000000000000000000000000000000000004563918244f4000000000000000000000000000000000000000000000000000000000000000003400000000000000000000000005409ed021d9299bf6814279a6a1411a7e866a6310000000000000000000000006ecbe1db9ef729cbe972c83fb886247691fb6beb00000000000000000000000000000000000000000000000000000000000000000000000000000000000000005409ed021d9299bf6814279a6a1411a7e866a6310000000000000000000000000000000000000000000000008ac7230489e800000000000000000000000000000000000000000000000000004563918244f4000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000005df7f091677c81f02e958f1c0dd4aa7615e42845cd8b3427f02cc02b053b8a9ad181526700000000000000000000000000000000000000000000000000000000000001c00000000000000000000000000000000000000000000000000000000000000220000000000000000000000000000000000000000000000000000000000000028000000000000000000000000000000000000000000000000000000000000002800000000000000000000000000000000000000000000000000000000000000024f47261b0000000000000000000000000871dd7c2b4b25e1aa18728e9d5f2af4c4e431f5c000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000024f47261b00000000000000000000000000b1ba0af832d7c05fd64161e0db78e85978e80820000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000240000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000421b8e41ab94c58c1c58ea10a96a766b2307439063b76d001103056dbb2c5b00cb4e171f3ccff827e5a2a143779181d52e923333841e16f672e52c4d29300991ca4d02000000000000000000000000000000000000000000000000000000000000","expirationTimeSeconds":"1576530065","gasPrice":"1"}`
const KnownTransactionHash = "0x8e5ad3640f4d194b8233506a476741c97ca44e44cd5b3976326b1859b1ba38d7"

func TestTransactionComputeHash(t *testing.T) {
	var testTransaction ZeroExTransaction
	err := json.Unmarshal([]byte(KnownTransactionJSON), &testTransaction)
	require.NoError(t, err)

	hash, err := testTransaction.ComputeHashForChainID(1337)
	require.NoError(t, err)
	assert.Equal(t, KnownTransactionHash, hash.Hex())
}
