---
kind: pipeline
type: docker
name: default

steps:
- name: test
  image: golang:1.13
  depends_on: ["clone"]
  volumes:
  - name: gomod
    path: /go/pkg/mod
  - name: gocache
    path: /root/.cache/go-build
  commands:
    - make ci

- name: lint
  image: golangci/golangci-lint:v1.21.0
  depends_on: ["clone"]
  volumes:
  - name: golint
    path: /root/.cache/golangci-lint
  commands:
    - make lint


services:
- name: 0x-snapshot
  pull: always
  image: gcr.io/zaidan-eth-net/0x-snapshot:v3

volumes:
  - name: gomod
    host: 
      path: /tmp/drone/zaidan/gomod
  - name: gocache
    host:
      path: /tmp/drone/zaidan/gocache
  - name: golint
    host:
      path: /tmp/drone/zaidan/golint

trigger:
  event:
  - pull_request
  
